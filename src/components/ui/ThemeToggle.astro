---
import { themeConfig } from '@/config'
import Icon from './Icon.astro'
---

{
  themeConfig.general.themeToggle && (
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
      <Icon name="moon" class="icon icon-moon" />
      <Icon name="sun" class="icon icon-sun" />
    </button>
  )
}

<script is:inline>
  function bindThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle')
    if (!themeToggle || !window.ThemeManager) return

    // Skip if already bound
    if (themeToggle.dataset.themeBound) return
    themeToggle.dataset.themeBound = 'true'

    themeToggle.addEventListener('click', function (e) {
      e.preventDefault()
      e.stopPropagation()
      window.ThemeManager.toggle()
    })
  }

  // Use only astro:page-load as it fires on initial load and navigation
  document.addEventListener('astro:page-load', bindThemeToggle)
</script>

<style>
  .theme-toggle {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    height: 1.5rem;
    gap: 0.1875rem;
    color: var(--text-primary);
    transition: opacity 0.2s ease;
    padding: 0 0 0 0.5rem;
    position: relative;
  }

  .theme-icon {
    width: 0.4375rem;
    height: 0.4375rem;
    transition: all 0.2s ease;
  }
</style>
